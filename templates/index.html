<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blue Ocean Food Tracker</title>
    
    <style>
        body {
            /* Using !important to override any lingering broken styles */
            background-image: url("{{ url_for('static', filename='background.png') }}") !important;
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
        }

        /* Grouping title and icons so they stay centered and together */
        .main-wrapper {
            text-align: center;
            padding-top: 40px;
            width: 100%;
        }

        .icon-container {
            display: flex;
            justify-content: center;
            gap: 50px;
            margin-top: 20px;
        }

        .app-icon {
            cursor: pointer;
            transition: transform 0.2s;
            width: 160px; /* Adjust size to your liking */
        }

        .app-icon:hover {
            transform: scale(1.05);
        }

        /* THE FIX: This forces the recipe to stay in a box and scroll */
        #recipe-section {
            position: fixed !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            
            width: 85vw !important;
            max-width: 500px !important;
            max-height: 75vh !important;
            
            background: rgba(255, 255, 255, 0.98) !important;
            padding: 25px !important;
            border-radius: 20px !important;
            box-shadow: 0 15px 50px rgba(0,0,0,0.4) !important;
            z-index: 9999 !important;
            
            overflow-y: auto !important; /* Forces vertical scroll */
            overflow-x: hidden !important; /* Stops side-cutoff */
            box-sizing: border-box !important;
        }

        #recipe-content {
            /* This is the magic for the text wrapping */
            white-space: pre-wrap !important;
            word-wrap: break-word !important;
            text-align: left !important;
            line-height: 1.6;
            color: #2c3e50;
        }

        .close-btn {
            float: right;
            background: #a94442;
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="main-wrapper">
        <h1>Blue Ocean Food Tracker</h1>
        
        <div class="icon-container">
            <div onclick="openFridge()">
                <img src="{{ url_for('static', filename='fridge.png') }}" class="app-icon" alt="Fridge">
                <p><strong>My Fridge</strong></p>
            </div>
            <div onclick="openRecipes()">
                <img src="{{ url_for('static', filename='cookbook.png') }}" class="app-icon" alt="Cookbook">
                <p><strong>Cookbook</strong></p>
            </div>
        </div>
    </div>

    <div id="recipe-section" style="display:none;">
        <button class="close-btn" onclick="document.getElementById('recipe-section').style.display='none'">X</button>
        <h2 style="color: #2c3e50; margin-top: 0;">Chef's Suggestion</h2>
        <hr>
        <div id="recipe-content">
            </div>
    </div>

    <script>
        // NAVIGATION LOGIC
        function toggleFridge() {
            const fridge = document.getElementById("fridge-section");
            const recipe = document.getElementById("recipe-section");
            
            fridge.classList.remove("hidden"); // Show fridge
            recipe.classList.add("hidden");    // Hide recipes
            loadFoods(); // Refresh list automatically
        }

        function toggleRecipes() {
            const fridge = document.getElementById("fridge-section");
            const recipe = document.getElementById("recipe-section");
            
            recipe.classList.remove("hidden"); // Show recipes
            fridge.classList.add("hidden");    // Hide fridge
        }

        // CORE API LOGIC
        async function addFood() {
            const food = document.getElementById("food").value;
            const seconds = document.getElementById("seconds").value;

            if (!food || !seconds) return alert("Please enter food and time!");

            await fetch("/api/add_food", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({food, seconds})
            });

            document.getElementById("food").value = "";
            document.getElementById("seconds").value = "";
            loadFoods();
        }

        async function loadFoods() {
            const res = await fetch("/api/foods");
            const data = await res.json();
            document.getElementById("foods").innerText = data.foods.join(", ") || "Fridge is empty!";
        }

        async function checkExpired() {
            const res = await fetch("/api/expired");
            const data = await res.json();
            document.getElementById("expired").innerText = 
                data.expired.length > 0 ? "Expired: " + data.expired.join(", ") : "Nothing has expired yet.";
            loadFoods();
        }

        async function getRecipe() {
            const food = document.getElementById("recipeFood").value;
            const res = await fetch(`/api/recipe/${food}`);
            const data = await res.json();
            document.getElementById("recipe").innerText = data.recipe;
        }
        function closeAll() {
            document.getElementById("fridge-section").classList.add("hidden");
            document.getElementById("recipe-section").classList.add("hidden");
        }

        // Initial background load
        loadFoods();

    </script>

</body>
</html>