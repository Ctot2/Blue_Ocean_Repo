<!DOCTYPE html>
<html>
    <head>
        <title>Blue Ocean Food Tracker</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
        <style>
            body {
                /* This forces the background image to find the correct Render path */
                background-image: url("{{ url_for('static', filename='background.png') }}") !important;
                background-size: cover;
                background-attachment: fixed;
                background-repeat: no-repeat;
                background-position: center;
                min-height: 100vh;
                margin: 0;
                display: block; /* Overrides flow-root if it's causing issues */
            }
    
            h1 {
                position: relative;
                top: 50px; /* Adjusted so it's not hidden by the top of the screen */
                z-index: 5;
            }
    
            .icon-container {
                display: flex;
                justify-content: center;
                gap: 50px;
                margin-top: 100px; /* Pulls the icons up so they are visible */
                position: relative;
                z-index: 10;
            }
    
            .icon-box {
                cursor: pointer;
                transition: transform 0.2s;
            }
    
            /* Ensuring the modals sit on top of everything */
            #fridge-section {
                z-index: 9999 !important; 
            }
            #recipe-section {
                /* This is the magic line for side-cutoff */
                white-space: pre-wrap !important; 
                
                /* These ensure words break if they are too long */
                word-wrap: break-word !important;
                overflow-wrap: break-word !important;
                
                /* Makes it look cleaner inside the box */
                text-align: left !important;
                padding: 10px !important;
                line-height: 1.5 !important;
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 80%;
                max-width: 600px;
                max-height: 80vh; /* Limits height to 80% of the screen */
                background: white;
                padding: 20px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 9999;
                
                /* THE FIXES */
                overflow-y: auto;        /* Adds vertical scrollbar if text is long */
                overflow-x: hidden;      /* Prevents horizontal stretching */
                white-space: pre-wrap;   /* Keeps AI formatting (line breaks) but wraps text */
                word-wrap: break-word;   /* Breaks long words if necessary */
            }

            /* Ensure the Close Button stays visible at the top */
            .close-btn {
                position: sticky;
                top: 0;
                float: right;
                background: #8b3a3a;
                color: white;
                border: none;
                padding: 5px 10px;
                border-radius: 5px;
                cursor: pointer;
                z-index: 10000;
            }
        </style>
        </head>
<body>
    
    <h1>Blue Ocean Food Tracker</h1>

    <div class="icon-container">
        <div class="icon-box" onclick="toggleFridge()">
            <img src="{{ url_for('static', filename='fridge.png') }}" alt="Fridge" class="app-icon">
            <p><strong>My Fridge</strong></p>
        </div>
        <div class="icon-box" onclick="toggleRecipes()">
            <img src="{{ url_for('static', filename='cookbook.png') }}" alt="Cookbook" class="app-icon">
            <p><strong>Cookbook</strong></p>
        </div>
    </div>

    <div id="fridge-section" class="hidden">
        <button class="close-button" onclick="closeAll()">x</button>
        <h2>Add Food</h2>
        <input id="food" placeholder="Food name">
        <input id="seconds" placeholder="time until expiration" type="number">
        <button onclick="addFood()">Add to Fridge</button>

        <hr>
        <h2>FridgeContents</h2>
        <div id="foods"></div>

        <h2>Check Status</h2>
        <button onclick="checkExpired()">Check Expired</button>
        <div id="expired"></div>
    </div>

    <div id="recipe-section" class="hidden">
        <button class="close-button" onclick="closeAll()">x</button>
        <h2>Find a Recipe</h2>
        <input id="recipeFood" placeholder="Enter ingredient">
        <button onclick="getRecipe()">Get Recipe</button>
        <pre id="recipe"></pre>
    </div>

    <script>
        // NAVIGATION LOGIC
        function toggleFridge() {
            const fridge = document.getElementById("fridge-section");
            const recipe = document.getElementById("recipe-section");
            
            fridge.classList.remove("hidden"); // Show fridge
            recipe.classList.add("hidden");    // Hide recipes
            loadFoods(); // Refresh list automatically
        }

        function toggleRecipes() {
            const fridge = document.getElementById("fridge-section");
            const recipe = document.getElementById("recipe-section");
            
            recipe.classList.remove("hidden"); // Show recipes
            fridge.classList.add("hidden");    // Hide fridge
        }

        // CORE API LOGIC
        async function addFood() {
            const food = document.getElementById("food").value;
            const seconds = document.getElementById("seconds").value;

            if (!food || !seconds) return alert("Please enter food and time!");

            await fetch("/api/add_food", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({food, seconds})
            });

            document.getElementById("food").value = "";
            document.getElementById("seconds").value = "";
            loadFoods();
        }

        async function loadFoods() {
            const res = await fetch("/api/foods");
            const data = await res.json();
            document.getElementById("foods").innerText = data.foods.join(", ") || "Fridge is empty!";
        }

        async function checkExpired() {
            const res = await fetch("/api/expired");
            const data = await res.json();
            document.getElementById("expired").innerText = 
                data.expired.length > 0 ? "Expired: " + data.expired.join(", ") : "Nothing has expired yet.";
            loadFoods();
        }

        async function getRecipe() {
            const food = document.getElementById("recipeFood").value;
            const res = await fetch(`/api/recipe/${food}`);
            const data = await res.json();
            document.getElementById("recipe").innerText = data.recipe;
        }
        function closeAll() {
            document.getElementById("fridge-section").classList.add("hidden");
            document.getElementById("recipe-section").classList.add("hidden");
        }

        // Initial background load
        loadFoods();
    </script>
</body>
</html>
